/*
formBuilder - http://kevinchappell.github.io/formBuilder/
Version: 1.3.0
Author: Kevin Chappell <kevin.b.chappell@gmail.com>
*/
"use strict";!function(e){var t=function(t,l){var a={theme:"fresh",labels:{off:"Off",on:"On"}},i=e.extend(a,l),o=e('<div class="kc-toggle"/>').insertAfter(t).append(t);o.toggleClass("on",t.is(":checked"));var n='<div class="kct-on">'+i.labels.on+"</div>",r='<div class="kct-off">'+i.labels.off+"</div>",s='<div class="kct-handle"></div>',c='<div class="kct-inner">'+n+s+r+"</div>";o.append(c),o.click(function(){t.attr("checked",!t.attr("checked")),e(this).toggleClass("on")})};e.fn.kcToggle=function(l){var a=this;return a.each(function(){var a=e(this);if(!a.data("kcToggle")){var i=new t(a,l);a.data("kcToggle",i)}})}}(jQuery),function(e){e.fn.toXML=function(t){var l={prepend:"",attributes:["class"]},a=e.extend(l,t),i="";return this.each(function(){var t=0,l=1;e(this).children().length>=1&&(i+="<form-template>\n	<fields>",e(this).children().each(function(){var o=e(this);if(!o.hasClass("moving")&&!o.hasClass("disabled"))for(var n=0;n<a.attributes.length;n++){var r=e("input.required",o).is(":checked")?'required="true" ':'required="false" ',s=e('input[name="multiple"]',o).is(":checked"),c=s?'style="multiple" ':"",d=o.attr(a.attributes[n]).replace(" form-field",""),p=d.match(/(select|checkbox-group|radio-group)/),u='type="'+d+'" ',f='name="'+e("input.fld-name",o).val()+'" ',m='label="'+e("input.fld-label",o).val()+'" ',v=e.map(e("input.roles-field:checked",o),function(e){return e.value}).join(","),h=""!==v?'role="'+v+'" ':"",g='description="'+e("input.fld-description",o).val()+'" ',b=e("input.fld-max-length",o).val(),x='max-length="'+(void 0!==b?b:"")+'" ',k=p?"":"/",y=e(".checkbox-toggle",o).is(":checked")?'toggle="true" ':"";i+="\n		<field "+f+m+y+c+h+g+(""!==b&&void 0!==b?x:"")+r+u+k+">",p&&(l=1,e(".sortable-options li",o).each(function(){var t=e(this),a='value="'+e(".option-value",t).val()+'"',o=e(".option-label",t).val(),n=e(".select-option",t).is(":checked")?' selected="true"':"";i+="\n			<option"+n+" "+a+">"+o+"</option>",l++}),i+="\n		</field>")}t++}),i+="\n	</fields>\n</form-template>")}),i}}(jQuery),function(e){var t=function(t,l){function a(e){this.elem=f}var i,o,n=this,r={dataType:"json",disableFields:{},defaultFields:[],roles:[{value:1,label:"Administrator"}],showWarning:!1,serializePrefix:"frmb",labels:{add:"Add Item",allowSelect:"Allow Select",autocomplete:"Autocomplete",cannotBeEmpty:"This field cannot be empty",checkboxGroup:"Checkbox Group",checkbox:"Checkbox",checkboxes:"Checkboxes","class":"Class",clearAllMessage:"Are you sure you want to remove all items?",clearAll:"Clear All",close:"Close",copy:"Copy To Clipboard",date:"Date Field",description:"Help Text",descriptionField:"Description",devMode:"Developer Mode",disableFields:"These fields cannot be moved.",editNames:"Edit Names",editXML:"Edit XML",fieldRemoveWarning:"Are you sure you want to remove this field?",getStarted:"Drag a field from the right to this area",hide:"Edit",label:"Label",labelEmpty:"Field Label cannot be empty",limitRole:"Limit access to one or more of the following roles:",mandatory:"Mandatory",maxLength:"Max Length",minOptionMessage:"This field requires a minimum of 2 options",name:"Name",no:"No",off:"Off",on:"On",optional:"optional",options:"Options",optionLabelPlaceholder:"Label",optionValuePlaceholder:"Value",optionEmpty:"Option value required",paragraph:"Paragraph",preview:"Preview",radioGroup:"Radio Group",radio:"Radio",removeMessage:"Remove Element",remove:"&#215;",required:"Required",roles:"Limit Access",save:"Save Template",selectOptions:"Select Items",select:"Select",selectionsMessage:"Allow Multiple Selections",text:"Text Field",textarea:"Text Area",warning:"Warning!",viewXML:"View XML",yes:"Yes"}},s=new Map,d={};a.prototype.json=function(){var t=e("input.required",n).is(":checked")?'required="true" ':'required="false" ',l=multipleChecked?'style="multiple" ':"",a=n.attr(u.attributes[att]).replace(" form-field",""),i=a.match(/(select|checkbox-group|radio-group)/),o='name="'+e("input.fld-name",n).val()+'" ',r='label="'+e("input.fld-label",n).val()+'" ',s=e.map(e("input.roles-field:checked",n),function(e){return e.value}).join(","),d=""!==s?'role="'+s+'" ':"",p=e("input.fld-description",n).val(),f=e("input.fld-max-length",$field).val(),m='max-length="'+(void 0!==f?f:"")+'" ',v=i?"":"/",h=e(".checkbox-toggle",$field).is(":checked")?'toggle="true" ':"";serialStr+="\n		<field "+o+r+h+l+d+p+(""!==f&&void 0!==f?m:"")+t+a+v+">",i&&(c=1,e(".sortable-options li",$field).each(function(){var t=e(this),l='value="'+e(".option-value",t).val()+'"',a=e(".option-label",t).val(),i=e(".select-option",t).is(":checked")?' selected="true"':"";serialStr+="\n			<option"+i+" "+l+">"+a+"</option>",c++}),serialStr+="\n		</field>")},d.uniqueArray=function(e){return e.filter(function(e,t,l){return l.indexOf(e)===t})},d.startMoving=function(t,l){t=t,l.item.addClass("moving"),i=e("li",this).index(l.item)},d.stopMoving=function(t,l){t=t,l.item.removeClass("moving"),o&&(e(l.sender).sortable("cancel"),e(this).sortable("cancel"))},d.safename=function(e){return e.replace(/\s/g,"-").replace(/[^a-zA-Z0-9\-]/g,"").toLowerCase()},d.forceNumber=function(e){return e.replace(/[^0-9]/g,"")},d.initTooltip=function(e){var t=e.find(".tooltip");e.mouseenter(function(){t.outerWidth()>200&&t.addClass("max-width"),t.css("left",e.width()+14),t.stop(!0,!0).fadeIn("fast")}).mouseleave(function(){e.find(".tooltip").stop(!0,!0).fadeOut("fast")}),t.hide()},d.save=function(){L.children("li.form-field").not(".disabled");console.log(s),"xml"===u.dataType&&f.val(L.toXML())},d.updatePreview=function(t){var l;e(".prev-holder",t).html(l)},d.nameAttr=function(e){var t=(new Date).getTime();return e+"-"+t},d.htmlEncode=function(t){return e("<div/>").text(t).html()},d.htmlDecode=function(t){return e("<div/>").html(t).text()},d.validateForm=function(){var t=[];e('input[name="label"], input[type="text"].option',L).each(function(){if(""===e(this).val()){var l=e(this).parents("li.form-field"),a=e(this);t.push({field:l,error:u.labels.labelEmpty,attribute:a})}}),t.length&&(alert("Error: "+t[0].error),e("html, body").animate({scrollTop:t[0].field.offset().top},1e3,function(){var l=e(".toggle-form",t[0].field).attr("id");e(".toggle-form",t[0].field).addClass("open").parent().next(".prev-holder").slideUp(250),e(document.getElementById(l+"-fld")).slideDown(250,function(){t[0].attribute.addClass("error")})}))},d.disabledTT=function(t){var l=t.attr("data-tooltip");if(l){t.removeAttr("title").data("tip_text",l);var a=e("<p/>",{"class":"frmb-tt"}).html(l);t.append(a),a.css({top:-a.outerHeight(),left:-15}),t.mouseleave(function(){e(this).attr("data-tooltip",t.data("tip_text")),e(".frmb-tt").remove()})}},String.prototype.toCamelCase=function(){return this.replace(/(\-\w)/g,function(e){return e[1].toUpperCase()})},d.markup=function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],l=arguments.length<=2||void 0===arguments[2]?"":arguments[2];t=N(t),l=Array.isArray(l)?l.join(""):l;var a=["input"],i=-1===a.indexOf(e)?"<"+e+" "+t+">"+l+"</"+e+">":"<"+e+" "+t+"/>";return i};var p=function(t){var l,a=Object.assign({},{label:t.label},t.attrs,t.meta),i=a.roles.map(function(e){return e.type="checkbox",e}),o=["required","label","description","class","roles","name"];if(a.name=a.name||d.nameAttr(a.type),-1!==e.inArray(a.type,["checkbox","select","checkbox-group","date","autocomplete"])||a.maxLength||(a.maxLength="",o.push("maxLength")),a.roles={options:i,value:1,type:"checkbox"},t.options){var n=t.options.map(function(e,t){var l={options:[],type:"none"};for(var a in e)if(e.hasOwnProperty(a)){var i={value:e[a],label:a,name:"option-"+a};"selected"===a&&(i.type="checkbox"),l.options.push(i)}return l});a.options={options:n,label:u.labels.options,type:"none"}}return delete a.type,l=d.uniqueArray(o.concat(Object.keys(a))).map(function(e){var t={name:e};return"object"==typeof a[e]?Object.assign(t,a[e]):t.value=a[e],t})},u=e.extend(r,l),f=e(t),m="frmb-"+e("ul[id^=frmb-]").length++,v=1,h=m+"-control-box",g=[{id:"text","class":"icon-text"},{id:"autocomplete","class":"icon-autocomplete"},{id:"select","class":"icon-select"},{id:"textarea","class":"icon-text-area"},{id:"date","class":"icon-calendar"},{id:"radio-group","class":"icon-radio-group"},{id:"checkbox","class":"icon-checkbox"},{id:"checkbox-group","class":"icon-checkbox-group"}],b=e("<ul/>",{id:h,"class":"frmb-control"}),x=g.map(function(t){var l=t.id.toCamelCase(),a=d.nameAttr(t.id),i={label:u.labels[l],meta:{description:"",roles:u.roles},attrs:{type:t.id,name:a,"class":t["class"],required:!1,id:a}};return-1!==e.inArray(t.id,["select","checkbox-group","radio-group"])&&(i.options=[{selected:!1,value:"option-1-value",label:"Option 1 Label"},{selected:!1,value:"option-2-value",label:"Option 2 Label"}]),i.properties=p(i),e("<li/>",i.attrs).data("fieldData",i).html(i.label).removeAttr("type")});b.append(x);var k=e("<a/>",{id:m+"-export-xml",text:u.labels.viewXML,"class":"view-xml"}),y=e("<a/>",{id:m+"-allow-select",text:u.labels.allowSelect,"class":"allow-select"}).prop("checked","checked"),C=e("<a/>",{id:m+"-edit-xml",text:u.labels.editXML,"class":"edit-xml"}),w=e("<a/>",{id:m+"-edit-names",text:u.labels.editNames,"class":"edit-names"}),T=e("<button/>",{text:u.labels.clearAll,"class":"clear-all btn btn-default"}),O=e("<button/>",{id:m+"-save",text:u.labels.save,"class":"save btn btn-primary"}),A=e("<div/>",{id:m+"-actions","class":"form-actions btn-group"}),M=e("<div/>",{id:m+"-action-links-inner","class":"action-links-inner"}).append(C," | ",w," | ",y," | ",T," |&nbsp;"),_=e("<span/>",{"class":"dev-mode-link"}).html(u.labels.devMode+" "+u.labels.off),E=e("<div/>",{id:m+"-action-links","class":"action-links"}).append(M,_);A.append(T,O);var L=e("<ul/>").attr("id",m).addClass("frmb").sortable({cursor:"move",opacity:.9,beforeStop:function(t,l){t=t;var a=e("> li",L).length-1,i=l.placeholder.index();o=1>=i||i===a},over:function(t){e(t.target).parent().addClass("active")},start:d.startMoving,stop:d.stopMoving,cancel:"input, .disabled, .sortable-options, .add, .btn, .no-drag, .prev-holder select",placeholder:"frmb-placeholder"});b.sortable({helper:"clone",opacity:.9,connectWith:L,cursor:"move",placeholder:"ui-state-highlight",start:d.startMoving,stop:d.stopMoving,revert:150,remove:function(t,l){0===i?b.prepend(l.item):e("li:eq("+(i-1)+")",b).after(l.item)},update:function(t,l){f.stopIndex=0===e("li",L).index(l.item)?"0":e("li",L).index(l.item),e("li",L).index(l.item)<0?e(this).sortable("cancel"):S(l.item,!0)},receive:function(t,l){(l.sender.hasClass("frmb")||l.sender.hasClass("frmb-control"))&&e(l.sender).sortable("cancel")}}),f.before(L).parent().addClass("frmb-wrap").append(E,k);var q=e("<div/>",{id:m+"-cb-wrap","class":"cb-wrap"}).append(b,A),D=e(".frmb-wrap").before(q).append(E),I=function(){if(0===e(this).parents("li.disabled").length){if("label"===e(this).name&&""===e(this).val())return alert("Error: "+u.labels.labelEmpty);d.save()}};e("input, select",L).on("change",I),e("input, select",L).on("blur",I),f.getTemplate=function(){var t=""!==f.val()?e.parseXML(f.val()):!1,l=e(t).find("field");if(l.length>0)l.each(function(){S(e(this))});else if(!t){if(u.defaultFields.length)for(var a=u.defaultFields.length-1;a>=0;a--)j(u.defaultFields[a]);else D.addClass("empty").attr("data-content",u.labels.getStarted);F()}};var F=function(){var t='<li class="disabled __POSITION__">__CONTENT__</li>';u.disableFields.before&&!e(".disabled.before",L).length&&L.prepend(t.replace("__POSITION__","before").replace("__CONTENT__",u.disableFields.before)),u.disableFields.after&&!e(".disabled.after",L).length&&L.append(t.replace("__POSITION__","after").replace("__CONTENT__",u.disableFields.after))},S=function(e){var t=e.data("fieldData");j(t),D.removeClass("empty"),F()},j=function(t){var l="",a=d.markup("a",{"class":"del-button btn",title:u.labels.removeMessage,id:"del_"+v},u.labels.remove),i=d.markup("a",{id:"frm-"+v,"class":"toggle-form btn icon-pencil",title:u.labels.hide}),o=d.markup("span",{"class":"required-asterisk"},"*"),n=t.description?d.markup("span",{"class":"tooltip-element",tooltip:t.description},"?"):"",r=d.markup("div",{"class":"field-label"},t.label,o,n),c=d.markup("div",{"class":"field-actions"},[i,a]),p=d.markup("div",{"class":"field-properties"},B(t.properties));l=d.markup("li",{id:d.nameAttr(t.attrs.type),"data-type":t.attrs.type,"class":t.attrs.type+" form-field"},[c,r,X(t),p]),f.stopIndex?e("li",L).eq(f.stopIndex).after(l):L.append(l),e(document.getElementById("frm-"+v+"-item")).hide().slideDown(250),v++;var m=JSON.stringify(t);s.set(t.attrs.id,m),d.save()},N=function(e){var t=[];for(var l in e)e.hasOwnProperty(l)&&t.push(l+'="'+e[l]+'"');return t.join(" ")},B=function(e){return e.map(function(e){var t=d.markup("div",{"class":"field-property "+e.name+"-wrap"},P(e));return t})},P=function U(t){var l=arguments.length<=1||void 0===arguments[1]?0:arguments[1],a=t.name||"",i=(a+"-"+v).replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),o=t.label||u.labels[a.toCamelCase()]||!1,n=t.fields||[],r=t.type||"text",s=t.value||"",c=[];if(t.options&&(l++,n=t.options.map(function(e){return U(e,l)}),n=d.markup("div",{"class":"property-options-"+l},n)),"none"!==r){var p={type:r,name:i,value:s,id:i,"class":"edit-"+a};2===l?p.placeholder=o.charAt(0).toUpperCase()+o.slice(1):1===l&&setTimeout(function(){e(".property-options-1",document.getElementById("frm-"+v+"-item")).sortable()},1e3),c.push(d.markup("input",p))}return o&&c.push(d.markup("label",{"for":i},o)),c.push(c,n),c.join("")},X=function(e){delete e.attrs["class"];var t={},l=e.attrs.type.toCamelCase();return t.text=function(e){var t=N(e.attrs),l="<input "+t+">",a=(e.attrs.value||"",'<label for="'+e.attrs.id+'">'+e.label+"</label>"),i={};return i.text=a+l,i.password=i.text,i.autocomplete=i.text,i.date=i.text,i[e.attrs.type]},t.password=Object.assign(t.text),t.email=t.text,t.date=t.text,t.autocomplete=t.text,t.textarea=function(e){var t=N(e.attrs),l=e.attrs.value||"",a="<textarea "+t+">"+l+"</textarea>",i='<label for="'+e.attrs.id+'">'+e.label+"</label>";return i+a},t.checkbox=function(e){var t=N(e.attrs);return'<label for="'+e.attrs.id+'"><input '+t+"> "+e.label+"</label>"},t.radio=t.checkbox,t.select=function(e){var t=void 0,l=e.attrs,a=function(e){var t=e.selected?"selected":"";return'<option value="'+e.value+'" '+t+">"+e.label+"</option>"},i=void 0;for(e.options.reverse(),i=e.options.length-1;i>=0;i--)t+=a(e.options[i]);return"<"+l.type+">"+t+"</"+l.type+">"},t.checkboxGroup=function(e){var l=[],a=Object.assign({},e);return a.attrs.type=a.attrs.type.replace("-group",""),a.attrs.name=a.attrs.name+"[]",delete a.options,e.options.forEach(function(e){a.label=e.label,a.attrs.value=e.value,l.push(t[a.attrs.type](a))}),l.join("")},t.radioGroup=t.checkboxGroup,'<div class="prev-holder">'+t[l](e)+"</div>"};L.on("click",".remove",function(t){t.preventDefault();var l=e(this).parents(".sortable-options:eq(0)").children("li").length;2>=l?alert("Error: "+u.labels.minOptionMessage):e(this).parent("li").slideUp("250",function(){e(this).remove()})}),L.on("click",".toggle-form",function(t){t.preventDefault();var l=document.getElementById(e(this).attr("id")+"-item");e(".prev-holder",l).toggleClass("open").slideToggle(250),e(".field-properties",l).slideToggle(250,function(){})}),L.on("keyup",".edit-label",function(t){e(".field-label",e(this).closest("li")).html(e(this).val())}),L.on("keyup","input.error",function(){e(this).removeClass("error")}),L.on("keyup",".edit-description",function(t){t.preventDefault();var l=e(".tooltip-element",e(this).closest("li"));if(""!==e(this).val())if(l.length)l.attr("tooltip",e(this).val()).css("display","inline-block");else{var a='<span class="tooltip-element" tooltip="'+e(this).val()+'">?</span>';e(".field-label",e(this).closest("li")).append(a)}else l.length&&l.css("display","none")}),L.on("keyup",".edit-name",function(){e(this).val(d.safename(e(this).val())),""===e(this).val()?e(this).addClass("field_error").attr("placeholder",u.labels.cannotBeEmpty):e(this).removeClass("field_error")}),L.on("keyup","input.fld-max-length",function(){e(this).val(d.forceNumber(e(this).val()))}),L.on("click",".del-button",function(t){t.preventDefault();var l=e(this).parents(".form-field:eq(0)");u.showWarning,G(l)});var G=function(t){var l=e("<h3/>").html("<span></span>"+u.labels.warning);e("<div />").append(l,u.labels.fieldRemoveWarning).dialog({modal:!0,resizable:!1,width:300,dialogClass:"ite-warning",buttons:[{text:u.labels.yes,click:function(){d.removeField(t),e(this).dialog("close")}},{text:u.labels.no,click:function(){e(this).dialog("close")}}]})};d.removeField=function(t){t.slideUp(250,function(){e(this).remove(),d.save()})},L.on("click",".edit-required",function(){var t=e(this).parents("li.form-field").find(".required-asterisk");t.toggle()}),L.on("click",".edit-roles",function(){var t=e(this).siblings(".property-options-1"),l=e(this);t.slideToggle(250,function(){l.is(":checked")||e('input[type="checkbox"]',t).removeAttr("checked")})}),L.on("mouseenter","li.disabled .form-element",function(){d.disabledTT(e(this))}),L.on("click",".close-field",function(t){t.preventDefault(),e(this).parents("li.form-field").find(".toggle-form").trigger("click")}),L.on("hover",".del-button",function(t){console.log("hovering!!");var l=e(this).parents(".form-field:eq(0)");l.toggleClass("delete")}),e(document.getElementById(m+"-export-xml")).click(function(t){t.preventDefault();var l=f.val(),a=e("<pre />").text(l);a.dialog({resizable:!1,modal:!0,width:720,dialogClass:"frmb-xml",overlay:{color:"#333333"}})}),T.click(function(e){e.preventDefault(),window.confirm(u.labels.clearAllMessage)&&(L.empty(),f.val(""),d.save(),f.getTemplate())}),T.hover(function(){e(this).toggleClass("btn-danger").toggleClass("btn-default")}),e(document.getElementById(m+"-save")).click(function(e){e.preventDefault(),D.hasClass("edit-xml")||d.save(),d.validateForm(e)});var R=!1,W=[],z="68,69,86";e(".save.btn").mouseover(function(){R=!0}).mouseout(function(){R=!1}),e(document.documentElement).keydown(function(t){W.push(t.keyCode),W.toString().indexOf(z)>=0&&(e(".action-links").toggle(),e(".view-xml").toggle(),W=[])}),e(".dev-mode-link").click(function(t){t.preventDefault();var l=e(this);D.toggleClass("dev-mode"),l.parent().css("opacity",1),D.hasClass("dev-mode")?(l.siblings(".action-links-inner").css("width","100%"),l.html(u.labels.devMode+" "+u.labels.on).css("color","#8CC63F")):(l.siblings(".action-links-inner").css("width",0),l.html(u.labels.devMode+" "+u.labels.off).css("color","#666666"),R=!1,e(".action-links").toggle(),e(".view-xml").toggle())}),e(document.getElementById(m+"-edit-names")).click(function(t){t.preventDefault(),e(this).toggleClass("active"),e(".name_wrap",L).slideToggle(250,function(){D.toggleClass("edit-names")})}),e(document.getElementById(m+"-allow-select")).click(function(t){t.preventDefault(),e(this).toggleClass("active"),e(".allow-multi, .select-option",L).slideToggle(250,function(){D.toggleClass("allow-select")})}),e(document.getElementById(m+"-edit-xml")).click(function(t){t.preventDefault(),e(this).toggleClass("active"),e("textarea.idea-template").show(),e(".template-textarea-wrap").slideToggle(250),D.toggleClass("edit-xml")}),D.css("min-height",b.height()-48),f.wrap('<div class="template-textarea-wrap"/>').getTemplate()};e.fn.formBuilder=function(l){var a=this;return a.each(function(){var a=e(this);if(!a.data("formBuilder")){var i=new t(this,l);a.data("formBuilder",i)}})}}(jQuery);