/*
formBuilder - http://kevinchappell.github.io/formBuilder/
Version: 1.3.0
Author: Kevin Chappell <kevin.b.chappell@gmail.com>
*/
"use strict";var _helpers=function e(t){var e={doCancel:!1},a=$(document.getElementById(t.formID));return e.uniqueArray=function(e){return e.filter(function(e,t,a){return a.indexOf(e)===t})},e.startDrag=function(t,a){t=t,a.item.addClass("moving"),e.startIndex=$("li",this).index(a.item)},e.stopDrag=function(t,a){t=t,a.item.removeClass("moving"),e.doCancel&&($(a.sender).sortable("cancel"),$(this).sortable("cancel"))},e.safename=function(e){return e.replace(/\s/g,"-").replace(/[^a-zA-Z0-9\-]/g,"").toLowerCase()},e.forceNumber=function(e){return e.replace(/[^0-9]/g,"")},e.initTooltip=function(e){var t=e.find(".tooltip");e.mouseenter(function(){t.outerWidth()>200&&t.addClass("max-width"),t.css("left",e.width()+14),t.stop(!0,!0).fadeIn("fast")}).mouseleave(function(){e.find(".tooltip").stop(!0,!0).fadeOut("fast")}),t.hide()},e.save=function(){a.children("li.form-field").not(".disabled");"xml"===t.dataType&&elem.val(a.toXML())},e.updatePreview=function(e){var t;$(".prev-holder",e).html(t)},e.nameAttr=function(e){var t=(new Date).getTime();return e+"-"+t},e.htmlEncode=function(e){return $("<div/>").text(e).html()},e.htmlDecode=function(e){return $("<div/>").html(e).text()},e.validateForm=function(){var e=[];$('input[name="label"], input[type="text"].option',a).each(function(){if(""===$(this).val()){var a=$(this).parents("li.form-field"),l=$(this);e.push({field:a,error:t.labels.labelEmpty,attribute:l})}}),e.length&&(alert("Error: "+e[0].error),$("html, body").animate({scrollTop:e[0].field.offset().top},1e3,function(){var t=$(".toggle-form",e[0].field).attr("id");$(".toggle-form",e[0].field).addClass("open").parent().next(".prev-holder").slideUp(250),$(document.getElementById(t+"-fld")).slideDown(250,function(){e[0].attribute.addClass("error")})}))},e.disabledTT=function(e){var t=e.attr("data-tooltip");if(t){e.removeAttr("title").data("tip_text",t);var a=$("<p/>",{"class":"frmb-tt"}).html(t);e.append(a),a.css({top:-a.outerHeight(),left:-15}),e.mouseleave(function(){$(this).attr("data-tooltip",e.data("tip_text")),$(".frmb-tt").remove()})}},String.prototype.toCamelCase=function(){return this.replace(/(\-\w)/g,function(e){return e[1].toUpperCase()})},e.markup=function(t){var a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],l=arguments.length<=2||void 0===arguments[2]?"":arguments[2];a=e.attrString(a),l=Array.isArray(l)?l.join(""):l;var i=["input"],n=-1===i.indexOf(t)?"<"+t+" "+a+">"+l+"</"+t+">":"<"+t+" "+a+"/>";return n},e.attrString=function(e){var t=[];for(var a in e)e.hasOwnProperty(a)&&t.push(a+'="'+e[a]+'"');return t.join(" ")},e.removeField=function(t){t.slideUp(250,function(){$(this).remove(),e.save()})},e};!function(e){var t=function(t,a){var l={theme:"fresh",labels:{off:"Off",on:"On"}},i=e.extend(l,a),n=e('<div class="kc-toggle"/>').insertAfter(t).append(t);n.toggleClass("on",t.is(":checked"));var o='<div class="kct-on">'+i.labels.on+"</div>",r='<div class="kct-off">'+i.labels.off+"</div>",s='<div class="kct-handle"></div>',c='<div class="kct-inner">'+o+s+r+"</div>";n.append(c),n.click(function(){t.attr("checked",!t.attr("checked")),e(this).toggleClass("on")})};e.fn.kcToggle=function(a){var l=this;return l.each(function(){var l=e(this);if(!l.data("kcToggle")){var i=new t(l,a);l.data("kcToggle",i)}})}}(jQuery),function(e){e.fn.toXML=function(t){var a={prepend:"",attributes:["class"]},l=e.extend(a,t),i="";return this.each(function(){var t=0,a=1;e(this).children().length>=1&&(i+="<form-template>\n	<fields>",e(this).children().each(function(){var n=e(this);if(!n.hasClass("moving")&&!n.hasClass("disabled"))for(var o=0;o<l.attributes.length;o++){var r=e("input.required",n).is(":checked")?'required="true" ':'required="false" ',s=e('input[name="multiple"]',n).is(":checked"),c=s?'style="multiple" ':"",d=n.attr(l.attributes[o]).replace(" form-field",""),p=d.match(/(select|checkbox-group|radio-group)/),u='type="'+d+'" ',f='name="'+e("input.fld-name",n).val()+'" ',m='label="'+e("input.fld-label",n).val()+'" ',v=e.map(e("input.roles-field:checked",n),function(e){return e.value}).join(","),h=""!==v?'role="'+v+'" ':"",g='description="'+e("input.fld-description",n).val()+'" ',b=e("input.fld-max-length",n).val(),x='max-length="'+(void 0!==b?b:"")+'" ',y=p?"":"/",k=e(".checkbox-toggle",n).is(":checked")?'toggle="true" ':"";i+="\n		<field "+f+m+k+c+h+g+(""!==b&&void 0!==b?x:"")+r+u+y+">",p&&(a=1,e(".sortable-options li",n).each(function(){var t=e(this),l='value="'+e(".option-value",t).val()+'"',n=e(".option-label",t).val(),o=e(".select-option",t).is(":checked")?' selected="true"':"";i+="\n			<option"+o+" "+l+">"+n+"</option>",a++}),i+="\n		</field>")}t++}),i+="\n	</fields>\n</form-template>")}),i}}(jQuery),function(e){var t=function(t,a){function l(e){this.elem=o}var i={dataType:"json",disableFields:{},defaultFields:[],roles:[{value:1,label:"Administrator"}],saveUrl:!1,showWarning:!1,serializePrefix:"frmb",labels:{add:"Add Item",allowSelect:"Allow Select",autocomplete:"Autocomplete",cannotBeEmpty:"This field cannot be empty",checkboxGroup:"Checkbox Group",checkbox:"Checkbox",checkboxes:"Checkboxes","class":"Class",clearAllMessage:"Are you sure you want to remove all items?",clearAll:"Clear All",close:"Close",copy:"Copy To Clipboard",date:"Date Field",description:"Help Text",descriptionField:"Description",devMode:"Developer Mode",disableFields:"These fields cannot be moved.",editNames:"Edit Names",editXML:"Edit XML",fieldRemoveWarning:"Are you sure you want to remove this field?",getStarted:"Drag a field from the right to this area",hide:"Edit",id:"ID",label:"Label",labelEmpty:"Field Label cannot be empty",limitRole:"Limit access to one or more of the following roles:",mandatory:"Mandatory",maxLength:"Max Length",minOptionMessage:"This field requires a minimum of 2 options",name:"Name",no:"No",off:"Off",on:"On",optional:"optional",options:"Options",optionLabelPlaceholder:"Label",optionValuePlaceholder:"Value",optionEmpty:"Option value required",paragraph:"Paragraph",preview:"Preview",radioGroup:"Radio Group",radio:"Radio",removeMessage:"Remove Element",remove:"&#215;",required:"Required",roles:"Limit Access",save:"Save Template",selectOptions:"Select Items",select:"Select",selectionsMessage:"Allow Multiple Selections",text:"Text Field",textarea:"Text Area",warning:"Warning!",viewXML:"View XML",yes:"Yes"}},n=e.extend(!0,i,a),o=e(t),r="frmb-"+e("ul[id^=frmb-]").length++;n.formID=r;var s=1,c=r+"-control-box",d=_helpers(n),p=new Map;l.prototype.json=function(){};var u=function(t){var a=Object.assign({},t),l=a.meta.roles.map(function(e){return e.type="checkbox",e}),i={meta:["label","description","roles"],attrs:["class","required","name"]};if(a.name=a.attrs.name||d.nameAttr(a.attrs.type),console.log(a),-1!==e.inArray(a.type,["checkbox","select","checkbox-group","date","autocomplete"])||a.attrs.maxLength||(a.attrs.maxLength="",i.push("maxLength")),a.meta.roles={options:l,value:1,type:"checkbox"},t.options){var o=t.options.map(function(e,t){var a={options:[],type:"none"};for(var l in e)if(e.hasOwnProperty(l)){var i={value:e[l],label:l,name:"option-"+l};"selected"===l&&(i.type="checkbox"),a.options.push(i)}return a});a.options={options:o,label:n.labels.options,type:"none"}}delete a.attrs.type;for(var r in a)a.hasOwnProperty(r)&&(a[r]=f(i,r));return $},f=function(e,t){var a=[];return Array.isArray(t)?a=d.uniqueArray(e.concat(Object.keys(t))).map(function(e){var a={name:e};return"object"==typeof t[e]?Object.assign(a,t[e]):a.value=t[e],a}):a.push(t),a},m=[{id:"text","class":"icon-text"},{id:"autocomplete","class":"icon-autocomplete"},{id:"select","class":"icon-select"},{id:"textarea","class":"icon-text-area"},{id:"date","class":"icon-calendar"},{id:"radio-group","class":"icon-radio-group"},{id:"checkbox","class":"icon-checkbox"},{id:"checkbox-group","class":"icon-checkbox-group"}],v=e("<ul/>",{id:c,"class":"frmb-control"}),h=m.map(function(t){var a=t.id.toCamelCase(),l=d.nameAttr(t.id),i={meta:{description:"",roles:n.roles,label:n.labels[a]},attrs:{type:t.id,name:l,"class":t["class"],required:!1,id:l}};return-1!==e.inArray(t.id,["select","checkbox-group","radio-group"])&&(i.options=[{selected:!1,value:"option-1-value",label:"Option 1 Label"},{selected:!1,value:"option-2-value",label:"Option 2 Label"}]),i.properties=u(i),e("<li/>",i.attrs).data("fieldData",i).html(i.label).removeAttr("type")});v.append(h);var g=e("<a/>",{id:r+"-export-xml",text:n.labels.viewXML,"class":"view-xml"}),b=e("<a/>",{id:r+"-allow-select",text:n.labels.allowSelect,"class":"allow-select"}).prop("checked","checked"),x=e("<a/>",{id:r+"-edit-xml",text:n.labels.editXML,"class":"edit-xml"}),y=e("<a/>",{id:r+"-edit-names",text:n.labels.editNames,"class":"edit-names"}),k=e("<button/>",{text:n.labels.clearAll,"class":"clear-all btn btn-default"}),C=e("<button/>",{id:r+"-save",text:n.labels.save,"class":"save btn btn-primary"}),w=e("<div/>",{id:r+"-actions","class":"form-actions btn-group"}),T=e("<div/>",{id:r+"-action-links-inner","class":"action-links-inner"}).append(x," | ",y," | ",b," | ",k," |&nbsp;"),A=e("<span/>",{"class":"dev-mode-link"}).html(n.labels.devMode+" "+n.labels.off),O=e("<div/>",{id:r+"-action-links","class":"action-links"}).append(T,A);w.append(k,C);var _=e("<ul/>").attr("id",r).addClass("frmb").sortable({cursor:"move",opacity:.9,beforeStop:function(t,a){t=t;var l=e("> li",_).length-1,i=a.placeholder.index();d.doCancel=1>=i||i===l},over:function(t){e(t.target).parent().addClass("active")},start:d.startDrag,stop:d.stopDrag,cancel:"input, .disabled, .sortable-options, .add, .btn, .no-drag, .prev-holder select",placeholder:"frmb-placeholder"});v.sortable({helper:"clone",opacity:.9,connectWith:_,cursor:"move",placeholder:"ui-state-highlight",start:d.startDrag,stop:d.stopDrag,revert:150,remove:function(t,a){0===d.startIndex?v.prepend(a.item):e("li:eq("+(d.startIndex-1)+")",v).after(a.item)},update:function(t,a){o.stopIndex=0===e("li",_).index(a.item)?"0":e("li",_).index(a.item),e("li",_).index(a.item)<0?e(this).sortable("cancel"):L(a.item,!0)},receive:function(t,a){(a.sender.hasClass("frmb")||a.sender.hasClass("frmb-control"))&&e(a.sender).sortable("cancel")}}),o.before(_).parent().addClass("frmb-wrap").append(O,g);var D=e("<div/>",{id:r+"-cb-wrap","class":"cb-wrap"}).append(v,w),E=e(".frmb-wrap").before(D).append(O),I=function(){if(0===e(this).parents("li.disabled").length){if("label"===e(this).name&&""===e(this).val())return alert("Error: "+n.labels.labelEmpty);d.save()}};e("input, select",_).on("change",I),e("input, select",_).on("blur",I),o.getTemplate=function(){var t=""!==o.val()?e.parseXML(o.val()):!1,a=e(t).find("field");if(a.length>0)a.each(function(){L(e(this))});else if(!t){if(n.defaultFields.length)for(var l=n.defaultFields.length-1;l>=0;l--)q(n.defaultFields[l]);else E.addClass("empty").attr("data-content",n.labels.getStarted);M()}};var M=function(){var t='<li class="disabled __POSITION__">__CONTENT__</li>';n.disableFields.before&&!e(".disabled.before",_).length&&_.prepend(t.replace("__POSITION__","before").replace("__CONTENT__",n.disableFields.before)),n.disableFields.after&&!e(".disabled.after",_).length&&_.append(t.replace("__POSITION__","after").replace("__CONTENT__",n.disableFields.after))},L=function(e){var t=e.data("fieldData");q(t),E.removeClass("empty"),M()},q=function(t){var a="",l=d.markup("a",{"class":"del-button btn",title:n.labels.removeMessage,id:"del_"+s},n.labels.remove),i=d.markup("a",{id:"frm-"+s,"class":"toggle-form btn icon-pencil",title:n.labels.hide}),r=d.markup("span",{"class":"required-asterisk"},"*"),c=t.description?d.markup("span",{"class":"tooltip-element",tooltip:t.description},"?"):"",u=d.markup("div",{"class":"field-label"},[t.label,r,c]),f=d.markup("div",{"class":"field-actions"},[i,l]),m=d.markup("div",{"class":"field-properties"},S(t));a=d.markup("li",{id:d.nameAttr(t.attrs.type),"data-type":t.attrs.type,"class":t.attrs.type+" form-field"},[f,u,j(t),m]),o.stopIndex?e("li",_).eq(o.stopIndex).after(a):_.append(a),e(document.getElementById("frm-"+s+"-item")).hide().slideDown(250),s++;var v=JSON.stringify(t);p.set(t.attrs.id,v),d.save()},S=function(e){var t=[],a=$(e.properties).join("");return t.push(a),t.join("")},$=function(e){return e.map(function(e){var t=d.markup("div",{"class":"field-property "+e.name+"-wrap"},F(e));return t})},F=function G(t){var a=arguments.length<=1||void 0===arguments[1]?0:arguments[1],l=t.name||"",i=(l+"-"+s).replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),o=t.label||n.labels[l.toCamelCase()]||!1,r=t.fields||[],c=t.type||"text",p=t.value||"",u=[];if("required"===l&&(c="checkbox"),t.options&&(a++,r=t.options.map(function(e){return G(e,a)}),r=d.markup("div",{"class":"property-options-"+a},r)),"none"!==c){var f={type:c,name:i,value:p,id:i,"class":"edit-"+l};2===a?f.placeholder=o.charAt(0).toUpperCase()+o.slice(1):1===a&&setTimeout(function(){e(".property-options-1",document.getElementById("frm-"+s+"-item")).sortable()},1e3),u.push(d.markup("input",f))}return o&&u.push(d.markup("label",{"for":i},o)),u.push(u,r),u.join("")},j=function(e){delete e.attrs["class"];var t={},a=e.attrs.type.toCamelCase();return t.text=function(e){var t=d.attrString(e.attrs),a="<input "+t+">",l=(e.attrs.value||"",'<label for="'+e.attrs.id+'">'+e.label+"</label>"),i={};return i.text=l+a,i.password=i.text,i.autocomplete=i.text,i.date=i.text,i[e.attrs.type]},t.password=Object.assign(t.text),t.email=t.text,t.date=t.text,t.autocomplete=t.text,t.textarea=function(e){var t=d.attrString(e.attrs),a=e.attrs.value||"",l="<textarea "+t+">"+a+"</textarea>",i='<label for="'+e.attrs.id+'">'+e.label+"</label>";return i+l},t.checkbox=function(e){var t=d.attrString(e.attrs);return'<label for="'+e.attrs.id+'"><input '+t+"> "+e.label+"</label>"},t.radio=t.checkbox,t.select=function(e){var t=void 0,a=e.attrs,l=function(e){var t=e.selected?"selected":"";return'<option value="'+e.value+'" '+t+">"+e.label+"</option>"},i=void 0;for(e.options.reverse(),i=e.options.length-1;i>=0;i--)t+=l(e.options[i]);return"<"+a.type+">"+t+"</"+a.type+">"},t.checkboxGroup=function(e){var a=[],l=Object.assign({},e);return l.attrs.type=l.attrs.type.replace("-group",""),l.attrs.name=l.attrs.name+"[]",delete l.options,e.options.forEach(function(e){l.label=e.label,l.attrs.value=e.value,a.push(t[l.attrs.type](l))}),a.join("")},t.radioGroup=t.checkboxGroup,'<div class="prev-holder">'+t[a](e)+"</div>"};_.on("click",".remove",function(t){t.preventDefault();var a=e(this).parents(".sortable-options:eq(0)").children("li").length;2>=a?alert("Error: "+n.labels.minOptionMessage):e(this).parent("li").slideUp("250",function(){e(this).remove()})}),_.on("click",".toggle-form",function(t){t.preventDefault();var a=e(this).parents(".form-field:eq(0)");a.toggleClass("editing"),e(".prev-holder",a).slideToggle(250),e(".field-properties",a).slideToggle(250,function(){})}),_.on("keyup",".edit-label",function(t){e(".field-label",e(this).closest("li")).html(e(this).val())}),_.on("keyup","input.error",function(){e(this).removeClass("error")}),_.on("keyup",".edit-description",function(t){t.preventDefault();var a=e(".tooltip-element",e(this).closest("li"));if(""!==e(this).val())if(a.length)a.attr("tooltip",e(this).val()).css("display","inline-block");else{var l='<span class="tooltip-element" tooltip="'+e(this).val()+'">?</span>';e(".field-label",e(this).closest("li")).append(l)}else a.length&&a.css("display","none")}),_.on("keyup",".edit-name",function(){e(this).val(d.safename(e(this).val())),""===e(this).val()?e(this).addClass("field_error").attr("placeholder",n.labels.cannotBeEmpty):e(this).removeClass("field_error")}),_.on("keyup","input.fld-max-length",function(){e(this).val(d.forceNumber(e(this).val()))}),_.on("click",".del-button",function(t){t.preventDefault();var a=e(this).parents(".form-field:eq(0)");n.showWarning,N(a)});var N=function(t){e("<div />",{title:n.labels.warning}).append(n.labels.fieldRemoveWarning).dialog({modal:!0,resizable:!1,dialogClass:"ite-warning",buttons:[{text:n.labels.yes,click:function(){d.removeField(t),e(this).dialog("close")}},{text:n.labels.no,click:function(){e(this).dialog("close")}}]},n.labels.warning)};_.on("click",".edit-required",function(){var t=e(this).parents("li.form-field").find(".required-asterisk");t.toggle()}),_.on("click",".edit-roles",function(){var t=e(this).siblings(".property-options-1"),a=e(this);t.slideToggle(250,function(){a.is(":checked")||e('input[type="checkbox"]',t).removeAttr("checked")})}),_.on("mouseenter","li.disabled .form-element",function(){d.disabledTT(e(this))}),_.on("click",".close-field",function(t){t.preventDefault(),e(this).parents("li.form-field").find(".toggle-form").trigger("click")}),_.on("hover",".del-button",function(t){console.log("hovering!!");var a=e(this).parents(".form-field:eq(0)");a.toggleClass("delete")}),e(document.getElementById(r+"-export-xml")).click(function(t){t.preventDefault();var a=o.val(),l=e("<pre />").text(a);l.dialog({resizable:!1,modal:!0,width:720,dialogClass:"frmb-xml",overlay:{color:"#333333"}})}),k.click(function(e){e.preventDefault(),window.confirm(n.labels.clearAllMessage)&&(_.empty(),o.val(""),d.save(),o.getTemplate())}),k.hover(function(){e(this).toggleClass("btn-danger").toggleClass("btn-default")}),e(document.getElementById(r+"-save")).click(function(e){e.preventDefault(),E.hasClass("edit-xml")||d.save(),d.validateForm(e)});var B=!1,P=[],X="68,69,86";e(".save.btn").mouseover(function(){B=!0}).mouseout(function(){B=!1}),e(document.documentElement).keydown(function(t){P.push(t.keyCode),P.toString().indexOf(X)>=0&&(e(".action-links").toggle(),e(".view-xml").toggle(),P=[])}),e(".dev-mode-link").click(function(t){t.preventDefault();var a=e(this);E.toggleClass("dev-mode"),a.parent().css("opacity",1),E.hasClass("dev-mode")?(a.siblings(".action-links-inner").css("width","100%"),a.html(n.labels.devMode+" "+n.labels.on).css("color","#8CC63F")):(a.siblings(".action-links-inner").css("width",0),a.html(n.labels.devMode+" "+n.labels.off).css("color","#666666"),B=!1,e(".action-links").toggle(),e(".view-xml").toggle())}),e(document.getElementById(r+"-edit-names")).click(function(t){t.preventDefault(),e(this).toggleClass("active"),e(".name_wrap",_).slideToggle(250,function(){E.toggleClass("edit-names")})}),e(document.getElementById(r+"-allow-select")).click(function(t){t.preventDefault(),e(this).toggleClass("active"),e(".allow-multi, .select-option",_).slideToggle(250,function(){E.toggleClass("allow-select")})}),e(document.getElementById(r+"-edit-xml")).click(function(t){t.preventDefault(),e(this).toggleClass("active"),e("textarea.idea-template").show(),e(".template-textarea-wrap").slideToggle(250),E.toggleClass("edit-xml")}),E.css("min-height",v.height()-48),o.wrap('<div class="template-textarea-wrap"/>').getTemplate()};e.fn.formBuilder=function(a){var l=this;return l.each(function(){var l=e(this);if(!l.data("formBuilder")){var i=new t(this,a);l.data("formBuilder",i)}})}}(jQuery);